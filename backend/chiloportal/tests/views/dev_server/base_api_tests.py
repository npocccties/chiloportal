from django.test import TestCase
import requests
from urllib.parse import urljoin
from rest_framework import status
import time


class BaseApiTests(TestCase):
    # 下記ドメインは実在するものに変更してからテストしてください
    base_url = "https://test-portal.oku.cccties.org/"
    frontend_url = base_url
    frontend_framework_stages_url = urljoin(
        frontend_url, "consumers/1/frameworks/1/stages/1"
    )
    backend_url = urljoin(base_url, "/api/v1/")
    consumer_detail_url = urljoin(backend_url, "consumer/")
    consumer_list_url = urljoin(backend_url, "consumer/list/")
    stage_field_list_url = urljoin(backend_url, "stage/field/list/")
    portal_category_list_url = urljoin(backend_url, "portalCategory/list/")
    portal_category_badge_list_url = urljoin(backend_url, "portalCategory/badges/list/")
    framework_url = urljoin(backend_url, "framework/")
    framework_stage_list_url = urljoin(backend_url, "framework/stage/list/")
    badges_url = urljoin(backend_url, "badges/")
    wisdom_badges_list_keyword_url = urljoin(backend_url, "wisdomBadges/list/keyword/")
    wisdom_badges_consumer_list_url = urljoin(
        backend_url, "wisdomBadges/consumer/list/"
    )
    consumer_framework_list_url = urljoin(backend_url, "consumer/framework/list/")
    test_data_count = 300
    proxies = [
        {"https": "110.78.186.2"},
        {"http": "114.37.206.199"},
        {"http": "139.162.8.86"},
        {"http": "140.82.1.202"},
        {"https": "148.72.152.156"},
        {"https": "182.253.109.232"},
        {"http": "185.11.89.124"},
        {"https": "185.217.137.242"},
        {"http": "209.146.105.242"},
        {"https": "36.80.136.178"},
        {"http": "76.164.52.98"},
        {"https": "182.253.109.234"},
        {"http": "104.148.36.10"},
        {"http": "114.37.203.86"},
        {"http": "110.164.3.7"},
        {"https": "195.225.232.3"},
        {"http": "209.201.29.20"},
        {"https": "157.100.12.138"},
        {"http": "114.37.147.48"},
        {"http": "42.3.182.146"},
        {"http": "139.162.8.96"},
        {"https": "134.238.252.143"},
        {"https": "47.242.43.30"},
        {"https": "60.51.17.107"},
        {"http": "117.159.37.40"},
        {"http": "118.107.44.181"},
        {"https": "140.227.61.156"},
        {"https": "140.227.80.237"},
        {"http": "80.249.112.162"},
        {"http": "51.178.56.44"},
        {"https": "140.227.59.167"},
        {"https": "190.26.201.194"},
        {"http": "165.154.236.248"},
        {"http": "154.26.134.214"},
        {"http": "36.32.21.45"},
        {"https": "140.227.69.124"},
        {"http": "112.6.117.178"},
        {"https": "45.167.126.78"},
        {"http": "51.91.157.66"},
        {"http": "111.21.183.58"},
        {"http": "103.111.120.138"},
        {"https": "76.72.138.48"},
        {"http": "117.251.103.186"},
        {"http": "118.140.160.85"},
        {"http": "118.140.160.84"},
        {"http": "221.231.13.198"},
        {"http": "37.236.59.107"},
        {"http": "125.66.100.112"},
        {"http": "103.49.202.252"},
        {"http": "113.73.189.192"},
        {"http": "37.236.59.107"},
        {"http": "103.117.192.14"},
        {"http": "103.117.192.174"},
        {"http": "183.237.47.54"},
        {"https": "172.104.60.117"},
        {"http": "103.83.232.122"},
        {"http": "183.233.169.226"},
        {"http": "120.197.219.82"},
        {"http": "139.99.237.62"},
        {"http": "209.182.239.62"},
        {"https": "92.205.22.114"},
        {"http": "203.89.126.250"},
        {"http": "112.5.56.2"},
        {"http": "198.49.68.80"},
        {"http": "173.167.64.58"},
        {"http": "198.59.191.234"},
        {"http": "112.49.34.128"},
        {"http": "165.154.243.247"},
        {"http": "118.212.152.82"},
        {"https": "140.227.25.191"},
        {"http": "221.6.215.202"},
        {"http": "117.160.250.134"},
        {"http": "103.172.116.231"},
        {"http": "58.246.58.150"},
        {"http": "14.205.213.11"},
        {"http": "209.146.105.243"},
        {"http": "119.7.135.19"},
        {"http": "123.130.115.217"},
        {"http": "120.26.123.95"},
        {"http": "51.195.251.79"},
        {"http": "139.162.8.32"},
        {"http": "110.185.164.20"},
        {"http": "113.57.84.39"},
        {"http": "223.96.90.216"},
        {"http": "185.235.16.12"},
        {"https": "200.105.215.22"},
        {"http": "58.20.184.187"},
        {"http": "120.196.186.248"},
        {"http": "120.196.188.21"},
        {"http": "58.27.59.249"},
        {"http": "103.148.178.228"},
        {"http": "218.7.171.91"},
        {"http": "172.104.80.181"},
        {"https": "220.241.131.164"},
        {"https": "45.167.253.129"},
        {"http": "45.124.12.10"},
        {"http": "117.160.250.132"},
        {"http": "117.160.250.132"},
        {"http": "103.145.76.44"},
        {"http": "117.160.250.132"},
        {"http": "223.108.49.50"},
        {"https": "182.92.161.220"},
        {"http": "118.107.44.181"},
        {"http": "120.236.41.185"},
        {"http": "122.228.136.27"},
        {"http": "124.13.181.4"},
        {"http": "117.160.250.134"},
        {"https": "135.181.22.40"},
        {"http": "117.160.250.133"},
        {"http": "117.160.250.134"},
        {"https": "20.113.40.250"},
        {"http": "183.220.6.198"},
        {"http": "117.160.250.133"},
        {"http": "8.210.222.138"},
        {"https": "167.235.21.123"},
        {"https": "118.27.113.167"},
        {"http": "223.84.240.36"},
        {"https": "39.107.234.215"},
        {"http": "171.34.53.2"},
        {"http": "117.160.250.133"},
        {"http": "124.13.181.6"},
        {"http": "8.141.251.188"},
        {"http": "217.197.162.40"},
        {"https": "49.0.2.242"},
        {"http": "116.120.158.55"},
        {"https": "160.16.90.62"},
        {"http": "124.13.181.7"},
        {"https": "205.134.235.132"},
        {"https": "178.238.212.160"},
        {"http": "181.129.49.214"},
        {"http": "46.151.108.69"},
        {"https": "112.140.186.124"},
        {"http": "118.212.73.69"},
        {"https": "181.205.173.74"},
        {"http": "203.198.207.253"},
        {"https": "12.46.236.24"},
        {"http": "171.6.118.155"},
        {"https": "145.40.121.167"},
        {"http": "124.158.6.56"},
        {"https": "177.141.99.50"},
        {"http": "51.15.242.202"},
        {"https": "160.16.62.113"},
        {"http": "39.105.15.159"},
        {"http": "102.219.179.58"},
        {"http": "123.183.160.83"},
        {"https": "14.140.131.82"},
        {"http": "185.126.225.54"},
        {"http": "216.137.184.253"},
        {"http": "211.161.103.139"},
        {"https": "110.34.3.229"},
        {"http": "15.235.150.136"},
        {"https": "171.244.10.193"},
        {"https": "160.16.72.239"},
        {"http": "160.16.100.225"},
        {"http": "187.217.54.84"},
        {"http": "117.160.250.132"},
        {"https": "160.16.114.15"},
        {"http": "182.106.220.252"},
        {"https": "1.255.134.136"},
        {"https": "188.124.250.138"},
        {"http": "117.160.250.134"},
        {"http": "117.160.250.133"},
        {"http": "47.96.162.91"},
        {"http": "117.50.159.109"},
        {"http": "39.105.156.66"},
        {"http": "43.255.113.232"},
        {"http": "43.255.113.232"},
        {"http": "43.255.113.232"},
        {"http": "43.255.113.232"},
        {"https": "160.16.63.39"},
        {"https": "160.16.80.32"},
        {"http": "112.44.126.88"},
        {"http": "8.142.18.73"},
        {"https": "200.94.142.218"},
        {"https": "52.81.68.24"},
        {"http": "45.79.110.81"},
        {"http": "41.188.149.75"},
        {"https": "185.198.72.60"},
        {"http": "154.239.9.81"},
        {"http": "12.69.91.227"},
        {"https": "217.28.220.234"},
        {"http": "103.174.102.127"},
        {"http": "183.89.41.25"},
        {"http": "39.104.60.218"},
        {"http": "77.41.146.59"},
        {"http": "62.193.108.143"},
        {"http": "41.188.149.78"},
        {"https": "160.16.112.239"},
        {"https": "36.90.12.6"},
        {"https": "154.0.171.221"},
        {"http": "91.238.190.26"},
        {"https": "101.109.176.77"},
        {"https": "52.81.74.120"},
        {"http": "157.100.26.69"},
        {"https": "120.55.241.143"},
        {"http": "60.210.40.190"},
        {"http": "103.134.177.182"},
        {"http": "14.17.94.9"},
        {"http": "128.201.232.102"},
        {"http": "192.236.160.186"},
    ]

    def request_frontend_framework_stages(self, total_count, interval_secconds):
        for i in range(total_count):
            response = requests.get(self.frontend_framework_stages_url)
            self.assertEqual(response.status_code, status.HTTP_200_OK)
            time.sleep(interval_secconds)

    def request_frontend_framework_stages_proxy(self, proxy):
        try:
            response = requests.get(self.frontend_framework_stages_url, proxies=proxy)
            self.assertEqual(response.status_code, status.HTTP_200_OK)
            print(f"OK: {proxy}")
        except requests.exceptions.RequestException as e:
            print(e)
            print(f"NG: {proxy}")
